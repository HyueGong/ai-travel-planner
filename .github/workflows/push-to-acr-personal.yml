# .github/workflows/push-to-acr-personal.yml
name: Push to ACR Personal Edition

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  ACR_REGISTRY: crpi-ku07xl4d7pm543bf.cn-hangzhou.personal.cr.aliyuncs.com
  NAMESPACE: hyuegong

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Log in to ACR Personal Registry
        run: |
          echo "${{ secrets.ACR_PASSWORD }}" | docker login \
            ${{ env.ACR_REGISTRY }} \
            --username "${{ secrets.ACR_USERNAME }}" \
            --password-stdin

      - name: Build and push backend image
        run: |
          docker build -f docker/Dockerfile.backend -t ${{ env.ACR_REGISTRY }}/${{ env.NAMESPACE }}/ai-travel-planner-backend:latest .
          docker push ${{ env.ACR_REGISTRY }}/${{ env.NAMESPACE }}/ai-travel-planner-backend:latest

      - name: Build and push frontend image
        run: |
          docker build -f docker/Dockerfile.frontend -t ${{ env.ACR_REGISTRY }}/${{ env.NAMESPACE }}/ai-travel-planner-frontend:latest .
          docker push ${{ env.ACR_REGISTRY }}/${{ env.NAMESPACE }}/ai-travel-planner-frontend:latest